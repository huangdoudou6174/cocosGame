
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/myGame/Script/Utils/PlygonSplitProgram.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '1b553rELBhOrKZzzxODssPA', 'PlygonSplitProgram');
// myGame/Script/Utils/PlygonSplitProgram.ts

Object.defineProperty(exports, "__esModule", { value: true });
var List_1 = require("./List");
var PlygonSplitProgram = /** @class */ (function () {
    function PlygonSplitProgram() {
    }
    /**
     * �ָ�����
     * @param points ����ζ�����������飬����ʱ������
     * @returns �ָ��������εĶ�����points�����е�������ÿ���������Ķ����ʾһ�������Σ�����ʱ������
     */
    PlygonSplitProgram.process = function (points) {
        if (points.length < 3)
            return [];
        this.pList = new List_1.default();
        for (var i = 0, c = points.length; i < c; ++i) {
            this.pList.push(new PointStatus(i, points[i]));
        }
        var node = this.pList.first;
        var concaveCount = 0;
        while (!!node) {
            this.updatePointStatus(node);
            if (!node.value.isConvex) {
                concaveCount++;
            }
            node = node.next;
        }
        if (concaveCount == 0) {
            var tri_1 = this.processConvexPlygon(points);
            this.reset();
            return tri_1;
        }
        if (concaveCount == 1) {
            var index = 0;
            var node_1 = this.pList.first;
            while (node_1.value.isConvex) {
                index++;
                node_1 = node_1.next;
            }
            var tri_2 = this.processSingleConcavePlygon(points, index);
            this.reset();
            return tri_2;
        }
        var tri = [];
        node = this.pList.first;
        while (this.pList.length >= 3) {
            while (!!node && !node.value.isSeparable) {
                node = node.next;
            }
            if (!node) {
                node = this.pList.first;
                while (!!node && !node.value.isSeparable) {
                    node = node.next;
                }
                if (!node) {
                    console.warn("����ηָ���δδ��ɣ����Ҳ����ɷָ��:", this.pList);
                    break;
                }
            }
            var prev = node.prev ? node.prev : this.pList.last;
            var next = node.next ? node.next : this.pList.first;
            tri.push(prev.value.pIndex, node.value.pIndex, next.value.pIndex);
            this.pList.removeNode(node);
            this.updatePointStatus(prev);
            this.updatePointStatus(next);
            node = next;
        }
        this.reset();
        return tri;
    };
    PlygonSplitProgram.updatePointStatus = function (node) {
        var prev = node.prev ? node.prev : this.pList.last;
        var next = node.next ? node.next : this.pList.first;
        if (!node.value.isConvex) {
            if (this.isConvex(node.value.point, node.prev.value.point, node.next.value.point)) {
                node.value.isConvex = true;
            }
            else {
                node.value.isSeparable = false;
                return;
            }
        }
        var tri = [prev.value.point, node.value.point, next.value.point];
        var p = this.pList.first;
        while (!!p) {
            if (!p.value.isConvex && p != node && p != prev && p != next) {
                if (this.inTriangle(p.value.point, tri)) {
                    node.value.isSeparable = false;
                    return;
                }
            }
            p = p.next;
        }
        node.value.isSeparable = true;
    };
    PlygonSplitProgram.processConvexPlygon = function (points) {
        var tri = [];
        for (var i = 1, c = points.length - 1; i < c; ++i) {
            tri.push(0, i, i + 1);
        }
        return tri;
    };
    PlygonSplitProgram.processSingleConcavePlygon = function (points, concavePointIndex) {
        if (concavePointIndex == 0) {
            return this.processConvexPlygon(points);
        }
        var tri = [];
        var index = concavePointIndex;
        var lastIndex = points.length - 1;
        for (var i = concavePointIndex + 1; i < lastIndex; ++i) {
            tri.push(index, i, i + 1);
        }
        if (index !== lastIndex) {
            tri.push(index, lastIndex, 0);
        }
        var preIndex = index - 1;
        for (var i = 0; i < preIndex; ++i) {
            tri.push(index, i, i + 1);
        }
        return tri;
    };
    PlygonSplitProgram.isConvex = function (p, p1, p2) {
        return this.cross(this.sub(p, p1), this.sub(p2, p)) >= 0;
    };
    PlygonSplitProgram.inTriangle = function (p, tri) {
        var ab = this.sub(tri[1], tri[0]);
        var ac = this.sub(tri[2], tri[0]);
        var bc = this.sub(tri[2], tri[1]);
        var ad = this.sub(p, tri[0]);
        var bd = this.sub(p, tri[1]);
        // let ac = tri[2].sub(tri[0]);
        // let bc = tri[2].sub(tri[1]);
        // let ad = p.sub(tri[0]);
        // let bd = p.sub(tri[1]);
        var b = this.cross(ab, ac) >= 0;
        return (b !== (this.cross(ab, ad) < 0)) &&
            (b !== this.cross(ac, ad) >= 0) &&
            (this.cross(bc, ab) > 0) !== (this.cross(bc, bd) >= 0);
    };
    PlygonSplitProgram.reset = function () {
        if (!!this.pList) {
            this.pList.reset();
            this.pList = null;
        }
    };
    PlygonSplitProgram.cross = function (p1, p2) {
        return p1.x * p2.y - p1.y * p2.x;
    };
    PlygonSplitProgram.sub = function (p1, p2) {
        return {
            x: p1.x - p2.x,
            y: p1.y - p2.y
        };
    };
    PlygonSplitProgram.pList = null;
    return PlygonSplitProgram;
}());
exports.default = PlygonSplitProgram;
var PointStatus = /** @class */ (function () {
    function PointStatus(index, v) {
        this.point = null;
        this.isConvex = false;
        this.isSeparable = false;
        this.pIndex = index;
        this.point = v;
    }
    return PointStatus;
}());

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbXlHYW1lXFxTY3JpcHRcXFV0aWxzXFxQbHlnb25TcGxpdFByb2dyYW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLCtCQUF3QztBQUt4QztJQUFBO0lBb0pBLENBQUM7SUFsSkc7Ozs7T0FJRztJQUNXLDBCQUFPLEdBQXJCLFVBQXNCLE1BQWM7UUFDaEMsSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUM7WUFBRSxPQUFPLEVBQUUsQ0FBQztRQUNqQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksY0FBSSxFQUFlLENBQUM7UUFDckMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRTtZQUMzQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNsRDtRQUNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQzVCLElBQUksWUFBWSxHQUFHLENBQUMsQ0FBQztRQUNyQixPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUU7WUFDWCxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFO2dCQUN0QixZQUFZLEVBQUUsQ0FBQzthQUNsQjtZQUNELElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ3BCO1FBQ0QsSUFBSSxZQUFZLElBQUksQ0FBQyxFQUFFO1lBQ25CLElBQUksS0FBRyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDYixPQUFPLEtB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Q0FBQyxDQUFDO0lBQ25CLENBQUM7SUFDTCxrQkFBQztBQUFELENBVEEsQUFTQyxJQUFBIiwiZmlsZSI6IiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExpc3QsIHsgTGlzdE5vZGUgfSBmcm9tIFwiLi9MaXN0XCI7XHJcbnR5cGUgVmVjMiA9IHtcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlclxyXG59XHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBseWdvblNwbGl0UHJvZ3JhbSB7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBwTGlzdDogTGlzdDxQb2ludFN0YXR1cz4gPSBudWxsO1xyXG4gICAgLyoqXHJcbiAgICAgKiDvv73WuO+/ve+/ve+/ve+/ve+/vVxyXG4gICAgICogQHBhcmFtIHBvaW50cyDvv73vv73vv73vv73Otu+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vemjrO+/ve+/ve+/ve+/vcqx77+977+977+977+977+977+9XHJcbiAgICAgKiBAcmV0dXJucyDvv73WuO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vc61xLbvv73vv73vv73vv73vv71wb2ludHPvv73vv73vv73vv73vv73Qte+/ve+/ve+/ve+/ve+/ve+/ve+/vcO/77+977+977+977+977+977+977+977+977+9xLbvv73vv73vv73vv73KvtK777+977+977+977+977+977+977+9zqPvv73vv73vv73vv73vv73Kse+/ve+/ve+/ve+/ve+/ve+/vVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHByb2Nlc3MocG9pbnRzOiBWZWMyW10pOiBudW1iZXJbXSB7XHJcbiAgICAgICAgaWYgKHBvaW50cy5sZW5ndGggPCAzKSByZXR1cm4gW107XHJcbiAgICAgICAgdGhpcy5wTGlzdCA9IG5ldyBMaXN0PFBvaW50U3RhdHVzPigpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBjID0gcG9pbnRzLmxlbmd0aDsgaSA8IGM7ICsraSkge1xyXG4gICAgICAgICAgICB0aGlzLnBMaXN0LnB1c2gobmV3IFBvaW50U3RhdHVzKGksIHBvaW50c1tpXSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbm9kZSA9IHRoaXMucExpc3QuZmlyc3Q7XHJcbiAgICAgICAgbGV0IGNvbmNhdmVDb3VudCA9IDA7XHJcbiAgICAgICAgd2hpbGUgKCEhbm9kZSkge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBvaW50U3RhdHVzKG5vZGUpO1xyXG4gICAgICAgICAgICBpZiAoIW5vZGUudmFsdWUuaXNDb252ZXgpIHtcclxuICAgICAgICAgICAgICAgIGNvbmNhdmVDb3VudCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjb25jYXZlQ291bnQgPT0gMCkge1xyXG4gICAgICAgICAgICBsZXQgdHJpID0gdGhpcy5wcm9jZXNzQ29udmV4UGx5Z29uKHBvaW50cyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRyaTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNvbmNhdmVDb3VudCA9PSAxKSB7XHJcbiAgICAgICAgICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICAgICAgICAgIGxldCBub2RlID0gdGhpcy5wTGlzdC5maXJzdDtcclxuICAgICAgICAgICAgd2hpbGUgKG5vZGUudmFsdWUuaXNDb252ZXgpIHtcclxuICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5uZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCB0cmkgPSB0aGlzLnByb2Nlc3NTaW5nbGVDb25jYXZlUGx5Z29uKHBvaW50cywgaW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cmk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB0cmk6IG51bWJlcltdID0gW107XHJcbiAgICAgICAgbm9kZSA9IHRoaXMucExpc3QuZmlyc3Q7XHJcbiAgICAgICAgd2hpbGUgKHRoaXMucExpc3QubGVuZ3RoID49IDMpIHtcclxuICAgICAgICAgICAgd2hpbGUgKCEhbm9kZSAmJiAhbm9kZS52YWx1ZS5pc1NlcGFyYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUubmV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgICAgIG5vZGUgPSB0aGlzLnBMaXN0LmZpcnN0O1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCEhbm9kZSAmJiAhbm9kZS52YWx1ZS5pc1NlcGFyYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCLvv73vv73vv73vv73Ot9a477+977+977+9zrTOtO+/ve+/vcmj77+977+977+977+90rLvv73vv73vv73vv73Jt9a47ral77+977+9OlwiLCB0aGlzLnBMaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgcHJldiA9IG5vZGUucHJldiA/IG5vZGUucHJldiA6IHRoaXMucExpc3QubGFzdDtcclxuICAgICAgICAgICAgbGV0IG5leHQgPSBub2RlLm5leHQgPyBub2RlLm5leHQgOiB0aGlzLnBMaXN0LmZpcnN0O1xyXG4gICAgICAgICAgICB0cmkucHVzaChwcmV2LnZhbHVlLnBJbmRleCwgbm9kZS52YWx1ZS5wSW5kZXgsIG5leHQudmFsdWUucEluZGV4KTtcclxuICAgICAgICAgICAgdGhpcy5wTGlzdC5yZW1vdmVOb2RlKG5vZGUpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBvaW50U3RhdHVzKHByZXYpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBvaW50U3RhdHVzKG5leHQpO1xyXG4gICAgICAgICAgICBub2RlID0gbmV4dDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICAgIHJldHVybiB0cmk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN0YXRpYyB1cGRhdGVQb2ludFN0YXR1cyhub2RlOiBMaXN0Tm9kZTxQb2ludFN0YXR1cz4pIHtcclxuICAgICAgICBsZXQgcHJldiA9IG5vZGUucHJldiA/IG5vZGUucHJldiA6IHRoaXMucExpc3QubGFzdDtcclxuICAgICAgICBsZXQgbmV4dCA9IG5vZGUubmV4dCA/IG5vZGUubmV4dCA6IHRoaXMucExpc3QuZmlyc3Q7XHJcbiAgICAgICAgaWYgKCFub2RlLnZhbHVlLmlzQ29udmV4KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ29udmV4KG5vZGUudmFsdWUucG9pbnQsIG5vZGUucHJldi52YWx1ZS5wb2ludCwgbm9kZS5uZXh0LnZhbHVlLnBvaW50KSkge1xyXG4gICAgICAgICAgICAgICAgbm9kZS52YWx1ZS5pc0NvbnZleCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBub2RlLnZhbHVlLmlzU2VwYXJhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHRyaSA9IFtwcmV2LnZhbHVlLnBvaW50LCBub2RlLnZhbHVlLnBvaW50LCBuZXh0LnZhbHVlLnBvaW50XTtcclxuICAgICAgICBsZXQgcCA9IHRoaXMucExpc3QuZmlyc3Q7XHJcbiAgICAgICAgd2hpbGUgKCEhcCkge1xyXG4gICAgICAgICAgICBpZiAoIXAudmFsdWUuaXNDb252ZXggJiYgcCAhPSBub2RlICYmIHAgIT0gcHJldiAmJiBwICE9IG5leHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluVHJpYW5nbGUocC52YWx1ZS5wb2ludCwgdHJpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUudmFsdWUuaXNTZXBhcmFibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcCA9IHAubmV4dDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbm9kZS52YWx1ZS5pc1NlcGFyYWJsZSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN0YXRpYyBwcm9jZXNzQ29udmV4UGx5Z29uKHBvaW50czogVmVjMltdKTogbnVtYmVyW10ge1xyXG4gICAgICAgIGxldCB0cmk6IG51bWJlcltdID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDEsIGMgPSBwb2ludHMubGVuZ3RoIC0gMTsgaSA8IGM7ICsraSkge1xyXG4gICAgICAgICAgICB0cmkucHVzaCgwLCBpLCBpICsgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cmk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN0YXRpYyBwcm9jZXNzU2luZ2xlQ29uY2F2ZVBseWdvbihwb2ludHM6IFZlYzJbXSwgY29uY2F2ZVBvaW50SW5kZXg6IG51bWJlcik6IG51bWJlcltdIHtcclxuICAgICAgICBpZiAoY29uY2F2ZVBvaW50SW5kZXggPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzQ29udmV4UGx5Z29uKHBvaW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB0cmk6IG51bWJlcltdID0gW107XHJcbiAgICAgICAgbGV0IGluZGV4ID0gY29uY2F2ZVBvaW50SW5kZXg7XHJcbiAgICAgICAgbGV0IGxhc3RJbmRleCA9IHBvaW50cy5sZW5ndGggLSAxO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSBjb25jYXZlUG9pbnRJbmRleCArIDE7IGkgPCBsYXN0SW5kZXg7ICsraSkge1xyXG4gICAgICAgICAgICB0cmkucHVzaChpbmRleCwgaSwgaSArIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5kZXggIT09IGxhc3RJbmRleCkge1xyXG4gICAgICAgICAgICB0cmkucHVzaChpbmRleCwgbGFzdEluZGV4LCAwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHByZUluZGV4ID0gaW5kZXggLSAxO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJlSW5kZXg7ICsraSkge1xyXG4gICAgICAgICAgICB0cmkucHVzaChpbmRleCwgaSwgaSArIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgaXNDb252ZXgocDogVmVjMiwgcDE6IFZlYzIsIHAyOiBWZWMyKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3Jvc3ModGhpcy5zdWIocCwgcDEpLCB0aGlzLnN1YihwMiwgcCkpID49IDA7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN0YXRpYyBpblRyaWFuZ2xlKHA6IFZlYzIsIHRyaTogVmVjMltdKTogYm9vbGVhbiB7XHJcbiAgICAgICAgbGV0IGFiID0gdGhpcy5zdWIodHJpWzFdLCB0cmlbMF0pO1xyXG4gICAgICAgIGxldCBhYyA9IHRoaXMuc3ViKHRyaVsyXSwgdHJpWzBdKTtcclxuICAgICAgICBsZXQgYmMgPSB0aGlzLnN1Yih0cmlbMl0sIHRyaVsxXSk7XHJcbiAgICAgICAgbGV0IGFkID0gdGhpcy5zdWIocCwgdHJpWzBdKTtcclxuICAgICAgICBsZXQgYmQgPSB0aGlzLnN1YihwLCB0cmlbMV0pO1xyXG4gICAgICAgIC8vIGxldCBhYyA9IHRyaVsyXS5zdWIodHJpWzBdKTtcclxuICAgICAgICAvLyBsZXQgYmMgPSB0cmlbMl0uc3ViKHRyaVsxXSk7XHJcbiAgICAgICAgLy8gbGV0IGFkID0gcC5zdWIodHJpWzBdKTtcclxuICAgICAgICAvLyBsZXQgYmQgPSBwLnN1Yih0cmlbMV0pO1xyXG4gICAgICAgIGxldCBiID0gdGhpcy5jcm9zcyhhYiwgYWMpID49IDA7XHJcbiAgICAgICAgcmV0dXJuIChiICE9PSAodGhpcy5jcm9zcyhhYiwgYWQpIDwgMCkpICYmXHJcbiAgICAgICAgICAgIChiICE9PSB0aGlzLmNyb3NzKGFjLCBhZCkgPj0gMCkgJiZcclxuICAgICAgICAgICAgKHRoaXMuY3Jvc3MoYmMsIGFiKSA+IDApICE9PSAodGhpcy5jcm9zcyhiYywgYmQpID49IDApO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVzZXQoKSB7XHJcbiAgICAgICAgaWYgKCEhdGhpcy5wTGlzdCkge1xyXG4gICAgICAgICAgICB0aGlzLnBMaXN0LnJlc2V0KCk7XHJcbiAgICAgICAgICAgIHRoaXMucExpc3QgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHByaXZhdGUgc3RhdGljIGNyb3NzKHAxOiBWZWMyLCBwMjogVmVjMik6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHAxLnggKiBwMi55IC0gcDEueSAqIHAyLng7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN0YXRpYyBzdWIocDE6IFZlYzIsIHAyOiBWZWMyKTogVmVjMiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgeDogcDEueCAtIHAyLngsXHJcbiAgICAgICAgICAgIHk6IHAxLnkgLSBwMi55XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgUG9pbnRTdGF0dXMge1xyXG4gICAgcHVibGljIHBJbmRleDogbnVtYmVyO1xyXG4gICAgcHVibGljIHBvaW50OiBWZWMyID0gbnVsbDtcclxuICAgIHB1YmxpYyBpc0NvbnZleDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHVibGljIGlzU2VwYXJhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoaW5kZXg6IG51bWJlciwgdjogVmVjMikge1xyXG4gICAgICAgIHRoaXMucEluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgdGhpcy5wb2ludCA9IHY7XHJcbiAgICB9XHJcbn0iXX0=